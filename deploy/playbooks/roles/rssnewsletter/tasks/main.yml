- name: Pull images
  docker_image:
    name: "{{ item }}"
    source: pull
    force: true
  loop: ["antoinechalifour/rss-newsletter:latest"]

- name: Ensure RSS Newsletter is running
  vars:
    smtp_host: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      36373235633037623663363132643838336266616439373539363637663535303161653364386566
      3131663264656438383033303963336166636361646633330a323930666335303037373632383830
      62376133303937326566653263646639393332386332333332353632616162623934303236383639
      6331316563656239310a663664376562613865343936363732316464343830393331356462393562
      3138
    smtp_username: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      36623837656232393864373265663963373661346362346138326665313339333562663533643066
      3664643131626366333364303464366461663562643362310a623463356338616561333636343265
      34663863376239313361636631386133356533373761323665353830373634616633643863346130
      3734393230626139360a363038353139376666623262343332316439396166343063396166643432
      39323535333663343032373864653833323563343230303666643031373663343561346131343034
      6161396331373231303837326338373163386533323939636435
    smtp_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      66306161363038656264623838323938663033366661363235303233393037376239363330326266
      3832353662623065376336656338636431356636633439660a616131313665333830356262663362
      62656339313333383365363464653462653135343331653864656130616631393063383964313830
      3335336637396164610a373035396439396265313836356438373661643433646433656364346366
      65663737373364346165666262366530623230623130363937666466353832613833
    recipient_name: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      33376639626361386466656165383033396165346135656635336131303166633264343734373731
      3132613735643765363235393961326534386334646162360a333561353433656465333230396537
      38393964613230393635663532376366343262646238383264383937326436336632356636653730
      3234346233333639650a303362663130613161366430353562386236653762366336626262346366
      66386565616130326634323438376232303038363034336331653734386461636562
    recipient_email: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      39636138653931636464313230336434356136623735613264313366626233376534646633363639
      3363393661323339663930653361313531393935393561640a336566316238373165303738663236
      39336464626631313539343832643466616164353333353765393866386362336635626565386266
      3464373730303633630a333533363733376163623235633738616637376531366233643438313537
      32343131643735353034623532366339393139336638653438353630326639656262
    auth_username: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      63633631386566366531343831643932313664343465633034383062643162356364616634306562
      3361386234653331363865353262663739653464393437640a366236623539353832656136306339
      65643139366139636635373763316632646236386232303336316661636336333266613263303031
      6261356536343662390a646237343831303861306539336131626262393866303863626538333739
      3936
    auth_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      31633066643230636162336364366361323765363939396536343864376137626364343766396463
      6135613931643134376664376433656238316533343366300a636361316665376436393432623930
      35363531376133333332323439333630303764393735633238393239643161386130393163336637
      6333663734383637640a653865663837393862323262326165653861663033383339346330643030
      6336
  docker_container:
    name: rss_newsletter_api
    image: antoinechalifour/rss-newsletter
    state: started
    env:
      SIMPLEJAVAMAIL_SMTP_HOST: "{{ smtp_host }}"
      SIMPLEJAVAMAIL_SMTP_PORT: ""
      SIMPLEJAVAMAIL_SMTP_USERNAME: "{{ smtp_username }}"
      SIMPLEJAVAMAIL_SMTP_PASSWORD: "{{ smtp_password }}"
      NEWSLETTER_RECIPIENT_NAME: "{{ recipient_name }}"
      NEWSLETTER_RECIPIENT_EMAIL: "{{ recipient_email }}"
      NEWSLETTER_AUTH_USERNAME: "{{ auth_username }}"
      NEWSLETTER_AUTH_PASSWORD: "{{ auth_password }}"
    ports:
      - "127.0.0.1:9090:8080"